<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>èŒèŒè·³è·ƒ ğŸ°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'å¹¼åœ†', 'å¾®è½¯é›…é»‘', sans-serif;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            touch-action: none;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #fce4ec, #e1f5fe);
        }

        /* ç™»å½•æ³¨å†Œç•Œé¢æ ·å¼ */
        .auth-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #fce4ec, #e1f5fe);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            padding: 20px;
        }

        .auth-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 8px 30px rgba(174, 129, 255, 0.2);
            border: 2px solid #e1bee7;
        }

        .auth-title {
            text-align: center;
            color: #7b1fa2;
            font-size: 28px;
            margin-bottom: 25px;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.9);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            background: #f3e5f5;
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            font-weight: bold;
            color: #7b1fa2;
            transition: all 0.2s ease;
        }

        .auth-tab.active {
            background: #ce93d8;
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #6a1b9a;
            font-weight: bold;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1bee7;
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #ba68c8;
            box-shadow: 0 0 10px rgba(186, 104, 200, 0.2);
        }

        .form-error {
            color: #e53935;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .auth-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(to right, #ba68c8, #8e24aa);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }

        .auth-btn:hover {
            background: linear-gradient(to right, #8e24aa, #ba68c8);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(186, 104, 200, 0.3);
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            color: #7b1fa2;
            font-size: 14px;
        }

        /* ä¸ªäººä¸­å¿ƒæ ·å¼ */
        .center-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }

        .center-box {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .center-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #7b1fa2;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .center-close:hover {
            background: #f3e5f5;
            transform: rotate(90deg);
        }

        .center-title {
            text-align: center;
            color: #7b1fa2;
            font-size: 28px;
            margin-bottom: 25px;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.9);
        }

        .skin-section {
            margin-top: 20px;
        }

        .skin-title {
            color: #6a1b9a;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }

        .skin-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .skin-item {
            background: #f3e5f5;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .skin-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(186, 104, 200, 0.3);
        }

        .skin-item.active {
            border-color: #ba68c8;
            background: #e1bee7;
        }

        .skin-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .skin-name {
            color: #7b1fa2;
            font-size: 14px;
            font-weight: bold;
        }

        /* ç”¨æˆ·ä¿¡æ¯æ  */
        .user-info {
            position: absolute;
            top: 3vh;
            right: 12vw;
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.85);
            padding: 0.5vw 1.5vw;
            border-radius: 50px;
            border: 2px solid #e1bee7;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 15;
        }

        .user-avatar {
            width: 5vw;
            height: 5vw;
            min-width: 30px;
            min-height: 30px;
            max-width: 40px;
            max-height: 40px;
            background: linear-gradient(135deg, #ff8fab, #f48fb1);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2vw;
            margin-right: 1vw;
        }

        .user-name {
            color: #7b1fa2;
            font-weight: bold;
            font-size: 2vw;
            max-width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #e53935;
            cursor: pointer;
            font-size: 1.8vw;
            margin-left: 1vw;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            transform: scale(1.1);
        }

        /* ä¸ªäººä¸­å¿ƒæŒ‰é’®æ ·å¼ */
        .center-btn {
            background: none;
            border: none;
            color: #ba68c8;
            cursor: pointer;
            font-size: 1.8vw;
            margin-left: 1vw;
            transition: all 0.2s ease;
        }

        .center-btn:hover {
            transform: scale(1.1);
            color: #7b1fa2;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #fff8e1;
            overflow: hidden;
            border: none;
            border-radius: 0;
            box-shadow: none;
        }

        .game-area {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #f0f8fb 0%, #e8f4f8 50%, #fdf2f8 100%);
            animation: bgFloat 20s infinite ease-in-out;
        }

        @keyframes bgFloat {
            0%, 100% { background-position: 0 0; }
            50% { background-position: 0 5px; }
        }

        /* ç©å®¶è§’è‰²ä¼˜åŒ– */
        .player {
            position: absolute;
            bottom: 8vh;
            left: 10vw;
            width: 6vw; 
            height: 6vw;
            min-width: 40px;
            min-height: 40px;
            max-width: 60px;
            max-height: 60px;
            z-index: 10;
            transition: 
                bottom 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
                transform 0.2s ease-in-out;
        }
		
		/* ç©å®¶çš®è‚¤é¢œè‰²æ ·å¼ */
		.player.skin-pink .player-inner {
		    background: #ff8fab;
		}
		
		.player.skin-blue .player-inner {
		    background: #4fc3f7;
		}
		
		.player.skin-yellow .player-inner {
		    background: #ffee58;
		}
		
		.player.skin-purple .player-inner {
		    background: #ba68c8;
		}
		
		.player.skin-green .player-inner {
		    background: #81c784;
		}

        .player-inner {
            width: 100%;
            height: 100%;
            background: #ff8fab;
            border-radius: 50% 50% 20% 20%;
            position: relative;
            box-shadow: inset -3px -3px 0 rgba(0,0,0,0.08);
            animation: bounceIdle 2s infinite ease-in-out, breath 3s infinite ease-in-out;
        }

        @keyframes breath {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        .player.jumping {
            filter: drop-shadow(0 3px 4px rgba(255, 143, 171, 0.3));
        }

        .player.jumping .player-inner {
            animation: none;
            transform: scale(0.95, 1.05) rotate(3deg);
            border-radius: 45% 55% 25% 15%;
        }

        .player.peaking .player-inner {
            transform: scale(1.05, 0.95) rotate(-2deg);
            border-radius: 50% 50% 15% 25%;
        }

        .player.falling .player-inner {
            transform: scale(1, 1) rotate(1deg);
        }

        .player-inner::before, .player-inner::after {
            content: '';
            position: absolute;
            top: 20%;
            width: 15%;
            height: 15%;
            background: #333;
            border-radius: 50%;
            transition: all 0.1s ease;
        }

        .player-inner::before { left: 20%; }
        .player-inner::after { right: 20%; }

        .player.jumping .player-inner::before,
        .player.jumping .player-inner::after {
            top: 22%;
            width: 15%;
            height: 3%;
            border-radius: 3px;
            background: #555;
        }

        .player.peaking .player-inner::before,
        .player.peaking .player-inner::after {
            width: 18%;
            height: 18%;
            top: 18%;
        }

        .player-mouth {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 25%;
            height: 12%;
            border-radius: 0 0 50% 50%;
            background: #333;
            overflow: hidden;
            transition: all 0.15s ease;
        }

        .player.jumping .player-mouth {
            width: 30%;
            height: 15%;
            border-radius: 50%;
            background: #ff6b6b;
        }

        .player.peaking .player-mouth {
            width: 20%;
            height: 18%;
            border-radius: 50%;
        }

        /* è·³è·ƒç‰¹æ•ˆ */
        .player.jumping::after {
            content: 'âœ¨';
            position: absolute;
            bottom: -20%;
            left: 50%;
            transform: translateX(-50%);
            animation: sparkle 0.3s ease-out forwards;
            font-size: 60%;
            z-index: 5;
        }

        .player.jumping::before {
            content: 'â­';
            position: absolute;
            bottom: -10%;
            left: calc(20% + var(--star-offset, 0px));
            transform: translateX(-50%);
            animation: sparkle 0.4s ease-out forwards 0.1s;
            font-size: 40%;
            z-index: 5;
        }

        @keyframes sparkle {
            0% { opacity: 1; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.8; transform: translateX(-50%) scale(1.2); }
            100% { opacity: 0; transform: translateX(-50%) scale(0.5) translateY(-10px); }
        }

        /* å¤šç§éšœç¢ç‰©æ ·å¼ */
        .obstacle {
            position: absolute;
            bottom: 8vh;
            width: 5vw;
            height: 5vw;
            min-width: 35px;
            min-height: 35px;
            max-width: 50px;
            max-height: 50px;
            border-radius: 20px 20px 15px 15px;
            transition: left 0.1s linear;
            box-shadow: inset -3px -3px 0 rgba(0,0,0,0.08);
            animation: obstaclePulse 2s infinite ease-in-out;
            z-index: 5;
        }

        /* åŸºç¡€éšœç¢ç‰© */
        .obstacle.basic {
            background: linear-gradient(135deg, #b794f4 0%, #9f7aea 100%);
        }

        .obstacle.basic::before {
            content: '';
            position: absolute;
            top: 20%;
            left: 20%;
            width: 15%;
            height: 15%;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
        }

        /* æµ®åŠ¨éšœç¢ç‰© */
        .obstacle.floating {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            animation: obstaclePulse 2s infinite ease-in-out, floatUpDown 3s infinite ease-in-out;
        }

        .obstacle.floating::before {
            content: 'ğŸŒŠ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5vw;
        }

        @keyframes floatUpDown {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.05); }
        }

        /* å¤§å‹éšœç¢ç‰© */
        .obstacle.large {
            width: 6vw;
            height: 8vw;
            min-width: 40px;
            min-height: 60px;
            max-width: 60px;
            max-height: 80px;
            background: linear-gradient(135deg, #ef5350 0%, #e53935 100%);
            border-radius: 25px 25px 15px 15px;
        }

        .obstacle.large::before {
            content: 'ğŸª¨';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2vw;
        }

        /* å¿«é€Ÿéšœç¢ç‰© */
        .obstacle.fast {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            width: 4vw;
            height: 4vw;
            min-width: 30px;
            min-height: 30px;
            max-width: 45px;
            max-height: 45px;
            animation: obstaclePulse 1s infinite ease-in-out, fastGlow 1.5s infinite ease-in-out;
        }

        .obstacle.fast::before {
            content: 'âš¡';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2vw;
        }

        @keyframes fastGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 152, 0, 0.5), inset -3px -3px 0 rgba(0,0,0,0.08); }
            50% { box-shadow: 0 0 15px rgba(255, 152, 0, 0.8), inset -3px -3px 0 rgba(0,0,0,0.08); }
        }

        /* æ˜“ç¢éšœç¢ç‰© */
        .obstacle.breakable {
            background: linear-gradient(135deg, #81c784 0%, #66bb6a 100%);
            opacity: 0.9;
        }

        .obstacle.breakable::before {
            content: 'ğŸƒ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5vw;
        }

        /* æ—‹è½¬éšœç¢ç‰© */
        .obstacle.rotating {
            background: linear-gradient(135deg, #26a69a 0%, #00897b 100%);
            animation: obstacleRotate 3s infinite linear, obstaclePulse 2s infinite ease-in-out;
        }

        .obstacle.rotating::before {
            content: 'ğŸ”„';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5vw;
        }

        @keyframes obstacleRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* éšœç¢ç‰©é€šç”¨åŠ¨ç”» */
        @keyframes obstaclePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* æ˜“ç¢éšœç¢ç‰©ç ´ç¢åŠ¨ç”» */
        @keyframes breakEffect {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2) rotate(10deg); opacity: 0.5; }
            100% { transform: scale(0); opacity: 0; }
        }

        .obstacle.breaking {
            animation: breakEffect 0.3s forwards;
        }

        /* åœ°é¢ä¼˜åŒ– */
        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 8vh;
            background: linear-gradient(180deg, #c8e6c9 0%, #b2dfdb 100%);
            border-top: 2px solid #a5d6a7;
        }

        .ground::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 15%;
            background: repeating-linear-gradient(
                90deg,
                #81c784,
                #81c784 2vw,
                #a5d6a7 2vw,
                #a5d6a7 4vw
            );
            opacity: 0.6;
            animation: groundScroll 10s linear infinite;
        }

        @keyframes groundScroll {
            0% { background-position: 0 0; }
            100% { background-position: -40vw 0; }
        }

        /* åˆ†æ•°ä¼˜åŒ– */
        .score {
            position: absolute;
            top: 3vh;
            left: 4vw;
            color: #7b1fa2;
            font-size: 5vw;
            font-weight: bold;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.9);
            background: rgba(255,255,255,0.85);
            padding: 1vw 2.5vw;
            border-radius: 50px;
            border: 2px solid #e1bee7;
            min-font-size: 24px;
            max-font-size: 40px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.1s ease;
        }

        .score.updating {
            transform: scale(1.1);
        }

        /* åˆ†æ•°çˆ†ç‚¸ç‰¹æ•ˆ */
        .score-pop {
            position: absolute;
            color: #7b1fa2;
            font-size: 2vw;
            font-weight: bold;
            pointer-events: none;
            animation: scorePop 1s forwards;
            z-index: 15;
        }

        @keyframes scorePop {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }

        /* é“å…·ç³»ç»Ÿ - å¢å¼ºè§†è§‰æ•ˆæœ */
        .power-up {
            position: absolute;
            bottom: 10vh;
            width: 4vw;
            height: 4vw;
            min-width: 30px;
            min-height: 30px;
            max-width: 45px;
            max-height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2vw;
            animation: float 2s infinite ease-in-out, powerUpGlow 1.5s infinite ease-in-out;
            z-index: 8;
            box-shadow: 0 0 20px rgba(255, 235, 59, 0.7);
        }

        /* é“å…·å‘å…‰ç‰¹æ•ˆ */
        @keyframes powerUpGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 235, 59, 0.5); }
            50% { box-shadow: 0 0 25px rgba(255, 235, 59, 0.9); }
        }

        .speed-boost {
            background: linear-gradient(135deg, #ffeb3b, #ffc107);
        }

        .shield {
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
        }

        .double-score {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        /* æ–°å¢é“å…·ï¼šæ—¶é—´å‡é€Ÿ */
        .slow-motion {
            background: linear-gradient(135deg, #9c27b0, #7b1fa2);
        }

        @keyframes float {
            0%,100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* æŠ¤ç›¾æ•ˆæœ */
        .player-shield {
            position: absolute;
            width: 120%;
            height: 120%;
            border: 2px solid #4fc3f7;
            border-radius: 50%;
            left: -10%;
            top: -10%;
            box-shadow: 0 0 15px #4fc3f7;
            animation: shieldPulse 1s infinite ease-in-out;
            z-index: 5;
            pointer-events: none;
        }

        @keyframes shieldPulse {
            0%,100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* æ¸¸æˆç»“æŸç•Œé¢ä¼˜åŒ– */
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #7b1fa2;
            text-align: center;
            display: none;
            background: rgba(255,255,255,0.98);
            padding: 2vw 4vw;
            border-radius: 25px;
            border: 2px solid #e1bee7;
            box-shadow: 0 5px 15px rgba(174, 129, 255, 0.2);
            width: 50%;
            max-width: 320px;
            min-width: 200px;
            animation: gameOverPopup 0.3s ease-out forwards;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
        }

        @keyframes gameOverPopup {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            70% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .game-over h1 {
            font-size: 5vw;
            margin-bottom: 1vw;
            color: #ec407a;
            text-shadow: 2px 2px 0 rgba(255,255,255,0.9);
            min-font-size: 24px;
            max-font-size: 36px;
        }

        .high-score {
            font-size: 2.5vw;
            color: #ff9800;
            margin-bottom: 1.5vw;
        }

        .game-over p {
            font-size: 3vw;
            margin-bottom: 2vw;
            min-font-size: 16px;
            max-font-size: 24px;
        }

        /* æŒ‰é’®ä¼˜åŒ– */
        .restart-btn {
            padding: 1.5vw 4vw;
            background: linear-gradient(to right, #f48fb1, #ff80ab);
            color: white;
            border: none;
            border-radius: 40px;
            font-size: 2.5vw;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 0 #d81b60;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
            min-font-size: 16px;
            max-font-size: 22px;
            min-width: 100px;
            width: 80%;
            position: relative;
            overflow: hidden;
        }

        .restart-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
            transform: rotate(45deg);
            animation: btnShine 3s infinite linear;
        }

        @keyframes btnShine {
            0% { transform: rotate(45deg) translateX(-100%); }
            100% { transform: rotate(45deg) translateX(100%); }
        }

        .restart-btn:hover {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #d81b60, 0 0 15px rgba(255, 128, 171, 0.5);
            background: linear-gradient(to right, #ff80ab, #f48fb1);
        }

        /* éŸ³æ•ˆæŒ‰é’®ä¼˜åŒ– */
        .sound-toggle {
            position: absolute;
            top: 3vh;
            right: 4vw;
            width: 7vw;
            height: 7vw;
            background: linear-gradient(to right, #b794f4, #9f7aea);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            color: white;
            font-size: 3.5vw;
            box-shadow: 0 3px 0 rgba(0,0,0,0.08);
            border: 2px solid white;
            min-width: 40px;
            min-height: 40px;
            max-width: 55px;
            max-height: 55px;
            animation: soundPulse 4s infinite ease-in-out;
        }

        @keyframes soundPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* æç¤ºæ–‡å­—ä¼˜åŒ– */
        .instructions {
            position: absolute;
            bottom: 3vh;
            left: 50%;
            transform: translateX(-50%);
            color: #6a1b9a;
            font-size: 2.5vw;
            text-align: center;
            background: rgba(255,255,255,0.9);
            padding: 1vw 3vw;
            border-radius: 50px;
            border: 2px solid #e1bee7;
            min-font-size: 14px;
            max-font-size: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            animation: instructionFade 10s infinite ease-in-out;
        }

        @keyframes instructionFade {
            0%, 80%, 100% { opacity: 1; }
            90% { opacity: 0.3; }
        }

        /* èƒŒæ™¯è£…é¥°ä¼˜åŒ– */
        .background-decoration {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .cloud {
            position: absolute;
            width: 12vw;
            height: 6vw;
            background: white;
            border-radius: 50px;
            opacity: calc(0.7 + var(--cloud-opacity, 0));
            animation: floatCloud 35s infinite linear;
            min-width: 80px;
            min-height: 40px;
            max-width: 120px;
            max-height: 60px;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.05));
        }

        .cloud::before {
            content: '';
            position: absolute;
            width: 6vw;
            height: 6vw;
            background: white;
            border-radius: 50%;
            top: -3vw;
            left: 3vw;
        }

        .cloud::after {
            content: '';
            position: absolute;
            width: 8vw;
            height: 8vw;
            background: white;
            border-radius: 50%;
            top: -4vw;
            right: 2vw;
        }

        .cloud-1 {
            top: 15vh;
            left: -15vw;
            animation-delay: 0s;
            --cloud-opacity: 0.2;
        }

        .cloud-2 {
            top: 35vh;
            left: -15vw;
            animation-delay: 10s;
            animation-duration: 40s;
            transform: scale(0.85);
            --cloud-opacity: 0.1;
        }

        .cloud-3 {
            top: 55vh;
            left: -15vw;
            animation-delay: 20s;
            animation-duration: 45s;
            transform: scale(0.7);
            --cloud-opacity: 0.15;
        }

        @keyframes floatCloud {
            0% { transform: translateX(0); }
            100% { transform: translateX(110vw); }
        }

        /* èƒŒæ™¯ç²’å­ */
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            border-radius: 50%;
            background: white;
            opacity: 0.8;
            pointer-events: none;
            animation: particleFloat 20s infinite linear;
        }

        @keyframes particleFloat {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100vw); }
        }

        /* éœ‡åŠ¨æ•ˆæœ */
        @keyframes vibrate {
            0%,100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-3px); }
            80% { transform: translateX(3px); }
        }

        /* åŠ è½½ç•Œé¢ */
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #fce4ec, #e1f5fe);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.5s ease-out;
        }

        .loading-icon {
            font-size: 8vw;
            animation: loadingSpin 2s infinite ease-in-out;
            margin-bottom: 2vw;
        }

        @keyframes loadingSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .loading-text {
            font-size: 3vw;
            color: #7b1fa2;
            animation: loadingPulse 1.5s infinite ease-in-out;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* åŸºç¡€åŠ¨ç”» */
        @keyframes bounceIdle {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-3px) rotate(0.5deg); }
        }

        @keyframes landShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-1px); }
            75% { transform: translateX(1px); }
        }

        .player.landing {
            animation: landShake 0.2s ease-in-out;
        }

        /* å“åº”å¼é€‚é… */
        @media (orientation: landscape) {
            .player { width: 5vw; height: 5vw; }
            .obstacle { width: 4.5vw; height: 4.5vw; }
            .obstacle.large { width: 5.5vw; height: 7vw; }
            .obstacle.fast { width: 3.5vw; height: 3.5vw; }
            .ground { height: 10vh; }
            .player, .obstacle { bottom: 10vh; }
            .score { font-size: 4vw; }
            .sound-toggle { width: 6vw; height: 6vw; font-size: 3vw; }
            .game-over { width: 40%; padding: 1.5vw 3vw; }
            .game-over h1 { font-size: 4vw; }
            .game-over p { font-size: 2.5vw; }
            .restart-btn { font-size: 2vw; padding: 1vw 3vw; }
            .user-info { right: 10vw; }
            .user-avatar { width: 4vw; height: 4vw; font-size: 1.8vw; }
            .user-name { font-size: 1.8vw; }
            .center-btn { font-size: 1.8vw; }
        }

        @media (max-width: 480px) {
            .score { font-size: 6vw; padding: 1.5vw 3vw; }
            .sound-toggle { width: 9vw; height: 9vw; font-size: 4.5vw; }
            .instructions { font-size: 3vw; padding: 1.5vw 4vw; }
            .game-over { width: 70%; padding: 3vw 5vw; max-width: 280px; }
            .game-over h1 { font-size: 6vw; }
            .game-over p { font-size: 4vw; margin-bottom: 3vw; }
            .restart-btn { padding: 2.5vw 6vw; font-size: 3.5vw; }
            .loading-icon { font-size: 12vw; }
            .loading-text { font-size: 4vw; }
            .obstacle::before { font-size: 3vw !important; }
            .power-up { font-size: 3vw !important; }
            .auth-box { padding: 20px; }
            .auth-title { font-size: 24px; }
            .user-info { right: 15vw; padding: 1vw 2vw; }
            .user-avatar { width: 8vw; height: 8vw; font-size: 3vw; }
            .user-name { font-size: 2.5vw; }
            .logout-btn { font-size: 2.5vw; }
            .center-btn { font-size: 2.5vw; }
            .skin-grid { grid-template-columns: repeat(2, 1fr); }
            .skin-preview { width: 50px; height: 50px; font-size: 24px; }
        }

        @media (min-width: 1024px) {
            .player { width: 50px; height: 50px; }
            .obstacle { width: 45px; height: 45px; }
            .obstacle.large { width: 55px; height: 75px; }
            .obstacle.fast { width: 35px; height: 35px; }
            .score { font-size: 36px; padding: 8px 20px; }
            .sound-toggle { width: 50px; height: 50px; font-size: 24px; }
            .instructions { font-size: 16px; padding: 8px 20px; }
            .game-over { width: 300px; padding: 15px 30px; }
            .game-over h1 { font-size: 28px; }
            .game-over p { font-size: 20px; margin-bottom: 15px; }
            .restart-btn { font-size: 18px; padding: 10px 30px; }
            .loading-icon { font-size: 60px; }
            .loading-text { font-size: 24px; }
            .obstacle::before { font-size: 18px !important; }
            .power-up { font-size: 18px !important; width: 40px; height: 40px; }
            .user-info { right: 8vw; }
            .user-avatar { width: 40px; height: 40px; font-size: 18px; }
            .user-name { font-size: 16px; }
            .logout-btn { font-size: 16px; }
            .center-btn { font-size: 16px; }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•æ³¨å†Œç•Œé¢ -->
    <div class="auth-container" id="auth-container">
        <div class="auth-box">
            <h2 class="auth-title">ğŸ° èŒèŒè·³è·ƒ - ç™»å½•</h2>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">ç™»å½•</div>
                <div class="auth-tab" data-tab="register">æ³¨å†Œ</div>
            </div>
            
            <!-- ç™»å½•è¡¨å• -->
            <div class="auth-form active" id="login-form">
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å</label>
                    <input type="text" class="form-input" id="login-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    <div class="form-error" id="login-username-error">ç”¨æˆ·åä¸èƒ½ä¸ºç©º</div>
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-input" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç ">
                    <div class="form-error" id="login-password-error">å¯†ç ä¸èƒ½ä¸ºç©º</div>
                </div>
                <div class="form-error" id="login-error" style="text-align: center; margin-bottom: 10px;">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</div>
                <button class="auth-btn" id="login-btn">ç™»å½•</button>
                <div class="auth-footer">
                    è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç‚¹å‡»æ³¨å†Œ
                </div>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div class="auth-form" id="register-form">
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å</label>
                    <input type="text" class="form-input" id="register-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆ2-10ä¸ªå­—ç¬¦ï¼‰">
                    <div class="form-error" id="register-username-error">ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®</div>
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-input" id="register-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰">
                    <div class="form-error" id="register-password-error">å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½</div>
                </div>
                <div class="form-group">
                    <label class="form-label">ç¡®è®¤å¯†ç </label>
                    <input type="password" class="form-input" id="register-confirm-password" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                    <div class="form-error" id="register-confirm-error">ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´</div>
                </div>
                <div class="form-error" id="register-error" style="text-align: center; margin-bottom: 10px;">ç”¨æˆ·åå·²å­˜åœ¨</div>
                <button class="auth-btn" id="register-btn">æ³¨å†Œ</button>
                <div class="auth-footer">
                    å·²æœ‰è´¦å·ï¼Ÿç‚¹å‡»ç™»å½•
                </div>
            </div>
        </div>
    </div>
	
    <!-- ä¸ªäººä¸­å¿ƒç•Œé¢ -->
    <div class="center-container" id="center-container">
        <div class="center-box">
            <div class="center-close" id="center-close">âœ•</div>
            <h2 class="center-title">ğŸ¨ ä¸ªäººä¸­å¿ƒ</h2>
            
            <!-- çš®è‚¤é€‰æ‹©åŒºåŸŸ -->
            <div class="skin-section">
                <h3 class="skin-title">ğŸ§¸ é€‰æ‹©ç©å®¶çš®è‚¤</h3>
                <div class="skin-grid" id="skin-grid">
                    <!-- çš®è‚¤é¡¹ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <div class="game-container">
        <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
        <div class="user-info" id="user-info" style="display: none;">
            <div class="user-avatar" id="user-avatar">ğŸ‘¤</div>
            <div class="user-name" id="user-name">ç”¨æˆ·å</div>
			<button class="center-btn" id="center-btn">ğŸ¨</button>
            <button class="logout-btn" id="logout-btn">ğŸšª</button>
        </div>
        
        <!-- åŠ è½½ç•Œé¢ -->
        <div class="loading-screen" id="loading-screen">
            <div class="loading-icon">ğŸ°</div>
            <div class="loading-text">èŒèŒè·³è·ƒåŠ è½½ä¸­...</div>
        </div>
        
        <div class="game-area">
            <!-- èƒŒæ™¯è£…é¥° -->
            <div class="background-decoration" id="background-particles"></div>
            <div class="background-decoration">
                <div class="cloud cloud-1"></div>
                <div class="cloud cloud-2"></div>
                <div class="cloud cloud-3"></div>
            </div>
            
            <!-- ç©å®¶è§’è‰² -->
            <div class="player skin-pink" id="player">
                <div class="player-inner">
                    <div class="player-mouth"></div>
                </div>
            </div>
            
            <!-- æ¸¸æˆå…ƒç´  -->
            <div class="ground"></div>
            <div class="score">0</div>
            <div class="sound-toggle" id="sound-toggle">ğŸ”Š</div>
            
            <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
            <div class="game-over">
                <h1>ğŸ’¥ æ¸¸æˆç»“æŸ ğŸ’¥</h1>
                <div class="high-score" id="high-score">æœ€é«˜åˆ†: 0 ä¸ª</div>
                <p>è·³è¿‡éšœç¢ç‰©: <span id="final-score">0</span> ä¸ª</p>
                <button class="restart-btn">âœ¨ é‡æ–°å¼€å§‹ âœ¨</button>
            </div>
            
            <!-- æç¤ºæ–‡å­—ä¼˜åŒ– -->
            <div class="instructions">
                ç‚¹å‡»/è§¦æ‘¸å±å¹•æˆ–æŒ‰ç©ºæ ¼é”®è·³è·ƒ ğŸ°<br>
                æ‹¾å–é“å…·è·å¾—å¼ºåŠ›æ•ˆæœï¼
            </div>
        </div>
    </div>

    <script>
        // ç­‰å¾…DOMåŠ è½½å®Œæˆåæ‰§è¡Œæ‰€æœ‰ä»£ç 
        document.addEventListener('DOMContentLoaded', function() {
            // ========== æ–°å¢ï¼šçš®è‚¤æ•°æ®å®šä¹‰ ==========
            const skinData = [
                { id: 'pink', name: 'ç²‰è‰²æ–¹å—', color: '#ff8fab', icon: 'ğŸ°' },
                { id: 'blue', name: 'è“è‰²æ–¹å—', color: '#4fc3f7', icon: 'ğŸ³' },
                { id: 'yellow', name: 'é»„è‰²æ–¹å—', color: '#ffee58', icon: 'ğŸ¤' },
                { id: 'purple', name: 'ç´«è‰²æ–¹å—', color: '#ba68c8', icon: 'ğŸ¦„' },
                { id: 'green', name: 'ç»¿è‰²æ–¹å—', color: '#81c784', icon: 'ğŸ¸' }
            ];
			
            // ç™»å½•æ³¨å†Œç›¸å…³å…ƒç´ 
            const authContainer = document.getElementById('auth-container');
            const authTabs = document.querySelectorAll('.auth-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            const userInfo = document.getElementById('user-info');
            const userAvatar = document.getElementById('user-avatar');
            const userName = document.getElementById('user-name');
            const logoutBtn = document.getElementById('logout-btn');
            
            // ========== æ–°å¢ï¼šä¸ªäººä¸­å¿ƒç›¸å…³å…ƒç´  ==========
            const centerContainer = document.getElementById('center-container');
            const centerBtn = document.getElementById('center-btn');
            const centerClose = document.getElementById('center-close');
            const skinGrid = document.getElementById('skin-grid');
            const player = document.getElementById('player');
			
            // è¡¨å•é”™è¯¯æç¤ºå…ƒç´ 
            const loginUsernameError = document.getElementById('login-username-error');
            const loginPasswordError = document.getElementById('login-password-error');
            const loginError = document.getElementById('login-error');
            const registerUsernameError = document.getElementById('register-username-error');
            const registerPasswordError = document.getElementById('register-password-error');
            const registerConfirmError = document.getElementById('register-confirm-error');
            const registerError = document.getElementById('register-error');
            
            // æ ¸å¿ƒæ¸¸æˆå…ƒç´ 
            const gameArea = document.querySelector('.game-area');
            const scoreElement = document.querySelector('.score');
            const gameOverScreen = document.querySelector('.game-over');
            const finalScoreElement = document.getElementById('final-score');
            const highScoreElement = document.getElementById('high-score');
            const restartBtn = document.querySelector('.restart-btn');
            const soundToggle = document.getElementById('sound-toggle');
            const gameContainer = document.querySelector('.game-container');
            const loadingScreen = document.getElementById('loading-screen');
            const backgroundParticles = document.getElementById('background-particles');
            
            // æ¸¸æˆæ ¸å¿ƒå‚æ•°
            let isJumping = false;
            let score = 0; // è·³è¿‡çš„éšœç¢ç‰©æ•°é‡
            let gameSpeed = 5;
            let obstacleInterval = 1800;
            let gameRunning = true;
            let obstacleTimer;
            let powerUpTimer;
            let soundEnabled = true;
            let currentUser = null; // å½“å‰ç™»å½•ç”¨æˆ·
            let userHighScores = {}; // æ‰€æœ‰ç”¨æˆ·çš„æœ€é«˜åˆ†
            let userSkins = {}; // å­˜å‚¨ç”¨æˆ·çš„çš®è‚¤é€‰æ‹©
            
            // é“å…·ç›¸å…³
            let isInvincible = false;
            let isDoubleScore = false;
            let isSpeedBoost = false;
            let isSlowMotion = false; // æ–°å¢ï¼šæ—¶é—´å‡é€Ÿ
            let shieldElement = null;
            let originalGameSpeed = 5; // è®°å½•åŸå§‹é€Ÿåº¦
            
            // å°ºå¯¸å‚æ•°
            let groundHeight = 8;
            let playerStartPos = groundHeight;
            let jumpHeight = 0;
            
            // è®°å½•å·²è·³è¿‡çš„éšœç¢ç‰©ID
            let skippedObstacleIds = new Set();
            let obstacleIdCounter = 0;
            
            // éšœç¢ç‰©ç±»å‹é…ç½®
            const obstacleTypes = [
                { 
                    type: 'basic', 
                    name: 'åŸºç¡€éšœç¢ç‰©', 
                    speedMultiplier: 1, 
                    sizeMultiplier: 1,
                    spawnChance: 0.4, // 40%æ¦‚ç‡
                    special: null
                },
                { 
                    type: 'floating', 
                    name: 'æµ®åŠ¨éšœç¢ç‰©', 
                    speedMultiplier: 1, 
                    sizeMultiplier: 1,
                    spawnChance: 0.25, // 25%æ¦‚ç‡
                    special: 'float'
                },
                { 
                    type: 'large', 
                    name: 'å¤§å‹éšœç¢ç‰©', 
                    speedMultiplier: 0.9, 
                    sizeMultiplier: 1.4,
                    spawnChance: 0.15, // 15%æ¦‚ç‡
                    special: 'large'
                },
                { 
                    type: 'fast', 
                    name: 'å¿«é€Ÿéšœç¢ç‰©', 
                    speedMultiplier: 1.4, 
                    sizeMultiplier: 0.8,
                    spawnChance: 0.15, // 15%æ¦‚ç‡
                    special: 'fast'
                },
                { 
                    type: 'rotating', 
                    name: 'æ—‹è½¬éšœç¢ç‰©', 
                    speedMultiplier: 1, 
                    sizeMultiplier: 1,
                    spawnChance: 0.05, // 5%æ¦‚ç‡
                    special: 'rotate'
                },
                { 
                    type: 'breakable', 
                    name: 'æ˜“ç¢éšœç¢ç‰©', 
                    speedMultiplier: 1, 
                    sizeMultiplier: 1,
                    spawnChance: 0.0, // åˆå§‹ç¦ç”¨ï¼Œåˆ†æ•°è¾¾åˆ°20åå¯ç”¨
                    special: 'breakable'
                }
            ];
            
            // é“å…·é…ç½®ï¼ˆæå‡æ¦‚ç‡ï¼‰
            const powerUpConfig = {
                spawnChance: 0.15, // ä»3%æå‡åˆ°15%çš„åŸºç¡€ç”Ÿæˆæ¦‚ç‡
                spawnInterval: 4000, // ä»8ç§’ç¼©çŸ­åˆ°4ç§’ç”Ÿæˆä¸€æ¬¡
                types: [
                    { type: 'speed-boost', icon: 'âš¡', chance: 0.3, duration: 6000 },
                    { type: 'shield', icon: 'ğŸ›¡ï¸', chance: 0.35, duration: 5000 }, // æé«˜æŠ¤ç›¾æ¦‚ç‡
                    { type: 'double-score', icon: 'âœ–2', chance: 0.25, duration: 8000 },
                    { type: 'slow-motion', icon: 'â±ï¸', chance: 0.1, duration: 7000 } // æ–°å¢ï¼šæ—¶é—´å‡é€Ÿ
                ]
            };
			
            // ====================== æ–°å¢ï¼šçš®è‚¤ç›¸å…³åŠŸèƒ½ ======================
            
            // åˆå§‹åŒ–çš®è‚¤é€‰æ‹©ç•Œé¢
            function initSkinSelection() {
                // æ¸…ç©ºçš®è‚¤ç½‘æ ¼
                skinGrid.innerHTML = '';
                
                // è·å–å½“å‰ç”¨æˆ·çš„çš®è‚¤è®¾ç½®
                const currentSkin = getUserSkin(currentUser);
                
                // ç”Ÿæˆçš®è‚¤é¡¹
                skinData.forEach(skin => {
                    const skinItem = document.createElement('div');
                    skinItem.className = `skin-item ${skin.id === currentSkin ? 'active' : ''}`;
                    skinItem.dataset.skinId = skin.id;
                    
                    skinItem.innerHTML = `
                        <div class="skin-preview" style="background: linear-gradient(135deg, ${skin.color}, ${lightenColor(skin.color, 20)});">
                            ${skin.icon}
                        </div>
                        <div class="skin-name">${skin.name}</div>
                    `;
					
                    // ç»‘å®šçš®è‚¤é€‰æ‹©äº‹ä»¶
                    skinItem.addEventListener('click', () => {
                        selectSkin(skin.id);
                    });
                    
                    skinGrid.appendChild(skinItem);
                });
            }
            
            // é€‰æ‹©çš®è‚¤
            function selectSkin(skinId) {
                if (!currentUser) return;
                
                // æ›´æ–°ç©å®¶çš®è‚¤æ ·å¼
                player.className = `player skin-${skinId}`;
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                userSkins[currentUser] = skinId;
                localStorage.setItem('userSkins', JSON.stringify(userSkins));
                
                // æ›´æ–°çš®è‚¤é€‰æ‹©ç•Œé¢çš„æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.skin-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.skinId === skinId);
                });
				
                // æç¤º
                alert(`å·²åˆ‡æ¢ä¸º${skinData.find(s => s.id === skinId).name}ï¼`);
            }
            
            // è·å–ç”¨æˆ·çš„çš®è‚¤è®¾ç½®
            function getUserSkin(username) {
                if (!username) return 'pink';
                
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½çš®è‚¤æ•°æ®
                const savedSkins = localStorage.getItem('userSkins');
                userSkins = savedSkins ? JSON.parse(savedSkins) : {};
                
                return userSkins[username] || 'pink';
            }
            
            // åº”ç”¨ç”¨æˆ·çš„çš®è‚¤è®¾ç½®
            function applyUserSkin(username) {
                const skinId = getUserSkin(username);
                player.className = `player skin-${skinId}`;
            }
			
            // è¾…åŠ©å‡½æ•°ï¼šè°ƒæ•´é¢œè‰²äº®åº¦
            function lightenColor(color, percent) {
                // ç§»é™¤#å·
                color = color.replace(/^#/, '');
                
                // è§£æRGB
                let r = parseInt(color.substr(0, 2), 16);
                let g = parseInt(color.substr(2, 2), 16);
                let b = parseInt(color.substr(4, 2), 16);
                
                // æé«˜äº®åº¦
                r = Math.min(255, Math.round(r * (100 + percent) / 100));
                g = Math.min(255, Math.round(g * (100 + percent) / 100));
                b = Math.min(255, Math.round(b * (100 + percent) / 100));
                
                // è½¬æ¢å›åå…­è¿›åˆ¶
                const rr = r.toString(16).padStart(2, '0');
                const gg = g.toString(16).padStart(2, '0');
                const bb = b.toString(16).padStart(2, '0');
                
                return `#${rr}${gg}${bb}`;
            }
            
            // ====================== ç™»å½•æ³¨å†Œç³»ç»Ÿ ======================
            
            // åˆå§‹åŒ–ç”¨æˆ·æ•°æ®
            function initUserData() {
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç”¨æˆ·æ•°æ®
                const savedUsers = localStorage.getItem('jumpGameUsers');
                const savedUserHighScores = localStorage.getItem('jumpGameHighScores');
                const savedUserSkins = localStorage.getItem('userSkins');
                const savedCurrentUser = localStorage.getItem('jumpGameCurrentUser');
                
                // åˆå§‹åŒ–ç”¨æˆ·åˆ—è¡¨
                window.jumpGameUsers = savedUsers ? JSON.parse(savedUsers) : {};
                
                // åˆå§‹åŒ–ç”¨æˆ·æœ€é«˜åˆ†
                userHighScores = savedUserHighScores ? JSON.parse(savedUserHighScores) : {};
                
                // åˆå§‹åŒ–ç”¨æˆ·çš®è‚¤æ•°æ®
                userSkins = savedUserSkins ? JSON.parse(savedUserSkins) : {};
                
                // æ£€æŸ¥æ˜¯å¦æœ‰è®°ä½çš„ç™»å½•ç”¨æˆ·
                if (savedCurrentUser) {
                    currentUser = savedCurrentUser;
                    showUserInfo();
                    hideAuthContainer();
                    applyUserSkin(currentUser); // åº”ç”¨ç”¨æˆ·çš®è‚¤
                    initGameAfterLogin();
                }
            }
            
            // åˆ‡æ¢ç™»å½•/æ³¨å†Œæ ‡ç­¾
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    authTabs.forEach(t => t.classList.remove('active'));
                    loginForm.classList.remove('active');
                    registerForm.classList.remove('active');
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
                    tab.classList.add('active');
                    if (tab.dataset.tab === 'login') {
                        loginForm.classList.add('active');
                    } else {
                        registerForm.classList.add('active');
                    }
                    
                    // é‡ç½®é”™è¯¯æç¤º
                    resetFormErrors();
                });
            });
            
            // é‡ç½®è¡¨å•é”™è¯¯æç¤º
            function resetFormErrors() {
                loginUsernameError.classList.remove('show');
                loginPasswordError.classList.remove('show');
                loginError.classList.remove('show');
                registerUsernameError.classList.remove('show');
                registerPasswordError.classList.remove('show');
                registerConfirmError.classList.remove('show');
                registerError.classList.remove('show');
            }
            
            // ç™»å½•éªŒè¯
            function validateLogin() {
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;
                
                // å…ˆæ¸…ç©ºæ‰€æœ‰é”™è¯¯
                resetFormErrors();
                
                let isValid = true;
                
                // éªŒè¯ç”¨æˆ·å
                if (!username) {
                    loginUsernameError.textContent = 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º';
                    loginUsernameError.classList.add('show');
                    isValid = false;
                }
                
                // éªŒè¯å¯†ç 
                if (!password) {
                    loginPasswordError.textContent = 'å¯†ç ä¸èƒ½ä¸ºç©º';
                    loginPasswordError.classList.add('show');
                    isValid = false;
                }
                
                // éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨ä¸”å¯†ç æ­£ç¡®
                if (isValid) {
                    if (!window.jumpGameUsers[username] || window.jumpGameUsers[username] !== password) {
                        loginError.classList.add('show');
                        isValid = false;
                    }
                }
                
                return isValid;
            }
            
            // æ³¨å†ŒéªŒè¯
            function validateRegister() {
                const username = document.getElementById('register-username').value.trim();
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                
                // å…ˆæ¸…ç©ºæ‰€æœ‰é”™è¯¯
                resetFormErrors();
                
                let isValid = true;
                
                // éªŒè¯ç”¨æˆ·å
                if (!username) {
                    registerUsernameError.textContent = 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º';
                    registerUsernameError.classList.add('show');
                    isValid = false;
                } else if (username.length < 2 || username.length > 10) {
                    registerUsernameError.textContent = 'ç”¨æˆ·åé•¿åº¦éœ€åœ¨2-10ä¸ªå­—ç¬¦';
                    registerUsernameError.classList.add('show');
                    isValid = false;
                } else if (window.jumpGameUsers[username]) {
                    registerError.classList.add('show');
                    isValid = false;
                }
                
                // éªŒè¯å¯†ç 
                if (!password) {
                    registerPasswordError.textContent = 'å¯†ç ä¸èƒ½ä¸ºç©º';
                    registerPasswordError.classList.add('show');
                    isValid = false;
                } else if (password.length < 6) {
                    registerPasswordError.textContent = 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½';
                    registerPasswordError.classList.add('show');
                    isValid = false;
                }
                
                // éªŒè¯ç¡®è®¤å¯†ç 
                if (password !== confirmPassword) {
                    registerConfirmError.classList.add('show');
                    isValid = false;
                }
                
                return isValid;
            }
            
            // ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            loginBtn.addEventListener('click', () => {
                if (validateLogin()) {
                    const username = document.getElementById('login-username').value.trim();
                    currentUser = username;
                    
                    // ä¿å­˜å½“å‰ç™»å½•ç”¨æˆ·
                    localStorage.setItem('jumpGameCurrentUser', currentUser);
                    
                    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
                    showUserInfo();
					
                    // åº”ç”¨ç”¨æˆ·çš®è‚¤
                    applyUserSkin(currentUser);
                    
                    // éšè—ç™»å½•æ³¨å†Œç•Œé¢
                    hideAuthContainer();
                    
                    // åˆå§‹åŒ–æ¸¸æˆ
                    initGameAfterLogin();
                }
            });
            
            // æ³¨å†ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            registerBtn.addEventListener('click', () => {
                if (validateRegister()) {
                    const username = document.getElementById('register-username').value.trim();
                    const password = document.getElementById('register-password').value;
                    
                    // ä¿å­˜æ–°ç”¨æˆ·
                    window.jumpGameUsers[username] = password;
                    localStorage.setItem('jumpGameUsers', JSON.stringify(window.jumpGameUsers));
                    
                    // åˆå§‹åŒ–ç”¨æˆ·æœ€é«˜åˆ†
                    if (!userHighScores[username]) {
                        userHighScores[username] = 0;
                        localStorage.setItem('jumpGameHighScores', JSON.stringify(userHighScores));
                    }
					
                    // åˆå§‹åŒ–ç”¨æˆ·çš®è‚¤
                    if (!userSkins[username]) {
                        userSkins[username] = 'pink';
                        localStorage.setItem('userSkins', JSON.stringify(userSkins));
                    }
                    
                    // è‡ªåŠ¨ç™»å½•
                    currentUser = username;
                    localStorage.setItem('jumpGameCurrentUser', currentUser);
                    
                    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
                    showUserInfo();
					
                    // åº”ç”¨ç”¨æˆ·çš®è‚¤
                    applyUserSkin(currentUser);
                    
                    // éšè—ç™»å½•æ³¨å†Œç•Œé¢
                    hideAuthContainer();
                    
                    // åˆå§‹åŒ–æ¸¸æˆ
                    initGameAfterLogin();
                    
                    // æç¤ºæ³¨å†ŒæˆåŠŸ
                    alert('æ³¨å†ŒæˆåŠŸï¼æ¬¢è¿åŠ å…¥èŒèŒè·³è·ƒï½');
                }
            });
			
            // ========== æ–°å¢ï¼šä¸ªäººä¸­å¿ƒäº‹ä»¶ç»‘å®š ==========
            // æ‰“å¼€ä¸ªäººä¸­å¿ƒ
            centerBtn.addEventListener('click', () => {
                centerContainer.style.display = 'flex';
                initSkinSelection(); // åˆå§‹åŒ–çš®è‚¤é€‰æ‹©ç•Œé¢
            });
            
            // å…³é—­ä¸ªäººä¸­å¿ƒ
            centerClose.addEventListener('click', () => {
                centerContainer.style.display = 'none';
            });
            
            // ç‚¹å‡»ä¸ªäººä¸­å¿ƒå¤–éƒ¨å…³é—­
            centerContainer.addEventListener('click', (e) => {
                if (e.target === centerContainer) {
                    centerContainer.style.display = 'none';
                }
            });
			
            // é€€å‡ºç™»å½•
            logoutBtn.addEventListener('click', () => {
                // æ¸…é™¤å½“å‰ç”¨æˆ·
                currentUser = null;
                localStorage.removeItem('jumpGameCurrentUser');
                
                // éšè—ç”¨æˆ·ä¿¡æ¯
                userInfo.style.display = 'none';
				
                // å…³é—­ä¸ªäººä¸­å¿ƒ
                centerContainer.style.display = 'none';
                
                // æ˜¾ç¤ºç™»å½•æ³¨å†Œç•Œé¢
                authContainer.style.display = 'flex';
                
                // é‡ç½®æ¸¸æˆ
                resetGame();
                
                // é‡ç½®è¡¨å•
                document.getElementById('login-username').value = '';
                document.getElementById('login-password').value = '';
                document.getElementById('register-username').value = '';
                document.getElementById('register-password').value = '';
                document.getElementById('register-confirm-password').value = '';
                resetFormErrors();
                
                // åˆ‡æ¢åˆ°ç™»å½•æ ‡ç­¾
                authTabs[0].click();
            });
            
            // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
            function showUserInfo() {
                if (currentUser) {
                    userName.textContent = currentUser;
                    // æ ¹æ®ç”¨æˆ·åé¦–å­—æ¯ç”Ÿæˆå¤´åƒ
                    const firstChar = currentUser.charAt(0).toUpperCase();
                    userAvatar.textContent = firstChar;
                    userInfo.style.display = 'flex';
                }
            }
            
            // éšè—ç™»å½•æ³¨å†Œç•Œé¢
            function hideAuthContainer() {
                authContainer.style.display = 'none';
            }
            
            // ====================== æ¸¸æˆæ ¸å¿ƒåŠŸèƒ½ ======================
            
            // ç™»å½•ååˆå§‹åŒ–æ¸¸æˆ
            function initGameAfterLogin() {
                // åŠ è½½ç”¨æˆ·æœ€é«˜åˆ†
                loadUserHighScore();
                
                // æ˜¾ç¤ºåŠ è½½ç•Œé¢
                loadingScreen.style.display = 'flex';
                
                // åˆå§‹åŒ–æ¸¸æˆ
                setTimeout(() => {
                    initGameSize();
                    createBackgroundParticles();
                    hideLoadingScreen();
                    
                    // åˆå§‹åŒ–éŸ³é¢‘
                    initAudio();
                    
                    // å¯åŠ¨æ¸¸æˆ
                    startGameTimers();
                    
                    // ç»‘å®šæ¸¸æˆæ§åˆ¶äº‹ä»¶
                    bindGameEvents();
                }, 1000);
            }
            
            // åˆå§‹åŒ–æ¸¸æˆå°ºå¯¸
            function initGameSize() {
                const screenHeight = window.innerHeight;
                groundHeight = screenHeight * 0.08;
                playerStartPos = groundHeight;
                jumpHeight = Math.min(screenHeight * 0.28, 200); // æé«˜è·³è·ƒé«˜åº¦åº”å¯¹å¤§å‹éšœç¢ç‰©
                
                document.querySelector('.ground').style.height = `${groundHeight}px`;
                player.style.bottom = `${groundHeight}px`;
                document.querySelectorAll('.obstacle').forEach(obs => {
                    obs.style.bottom = `${groundHeight}px`;
                });
            }
            
            // åˆ›å»ºèƒŒæ™¯ç²’å­
            function createBackgroundParticles() {
                for (let i = 0; i < 15; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    particle.style.left = `${Math.random() * 100}vw`;
                    particle.style.top = `${Math.random() * 100}vh`;
                    particle.style.animationDuration = `${Math.random() * 10 + 10}s`;
                    backgroundParticles.appendChild(particle);
                }
            }
            
            // éšè—åŠ è½½ç•Œé¢
            function hideLoadingScreen() {
                loadingScreen.style.opacity = 0;
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }
            
            // ç»‘å®šæ¸¸æˆæ§åˆ¶äº‹ä»¶
            function bindGameEvents() {
                // ç‚¹å‡»/è§¦æ‘¸è·³è·ƒ
                document.addEventListener('click', jump);
                document.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    jump();
                });
                
                // ç©ºæ ¼é”®è·³è·ƒ
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        jump();
                    }
                });
                
                // éŸ³æ•ˆåˆ‡æ¢
                soundToggle.addEventListener('click', toggleSound);
                
                // é‡æ–°å¼€å§‹æ¸¸æˆ
                restartBtn.addEventListener('click', restartGame);
                
                // çª—å£å¤§å°å˜åŒ–ç›‘å¬
                window.addEventListener('resize', () => {
                    initGameSize();
                    
                    if (gameRunning) {
                        const aspectRatio = window.innerWidth / window.innerHeight;
                        if (aspectRatio > 2) {
                            gameSpeed = Math.min(gameSpeed, 7);
                        } else if (aspectRatio < 1) {
                            gameSpeed = Math.max(gameSpeed, 4.5);
                        }
                    }
                });
            }
            
            // éŸ³æ•ˆç³»ç»Ÿ
            let audioContext;
            let jumpSound;
            let hitSound;
            let scoreSound;
            let landSound;
            let powerUpSound;
            let highScoreSound;
            let breakSound;
            let slowMotionSound; // æ–°å¢ï¼šæ…¢åŠ¨ä½œéŸ³æ•ˆ
            
            function initAudio() {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // åˆ›å»ºéŸ³æ•ˆ
                    jumpSound = createSound(800, 0.12, 0.06, 'sine');
                    hitSound = createSound(400, 0.25, 0.12, 'square');
                    scoreSound = createSound(1200, 0.09, 0.04, 'sine');
                    landSound = createSound(500, 0.1, 0.05, 'triangle');
                    powerUpSound = createSound(1500, 0.15, 0.07, 'sine');
                    highScoreSound = createSound(1760, 0.15, 0.07, 'sine');
                    breakSound = createSound(600, 0.2, 0.1, 'sawtooth'); // ç ´ç¢éŸ³æ•ˆ
                    slowMotionSound = createSound(440, 0.3, 0.15, 'sine', 0.08); // æ…¢åŠ¨ä½œéŸ³æ•ˆ
                } catch (e) {
                    console.log('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:', e);
                }
            }
            
            // åˆ›å»ºéŸ³æ•ˆè¾…åŠ©å‡½æ•°
            function createSound(frequency = 440, duration = 0.1, decay = 0.05, type = 'sine', volume = 0.12) {
                return function() {
                    if (!soundEnabled || !audioContext) return;
                    
                    if (audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                    
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = type;
                    oscillator.frequency.value = frequency;
                    
                    gainNode.gain.value = volume;
                    gainNode.gain.exponentialRampToValueAtTime(
                        0.00001, audioContext.currentTime + duration
                    );
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + duration);
                };
            }
            
            // åˆ‡æ¢éŸ³æ•ˆ
            function toggleSound() {
                soundEnabled = !soundEnabled;
                soundToggle.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            }
            
            // åŠ è½½ç”¨æˆ·æœ€é«˜åˆ†
            function loadUserHighScore() {
                if (currentUser) {
                    const userScore = userHighScores[currentUser] || 0;
                    highScoreElement.textContent = `æœ€é«˜åˆ†: ${userScore} ä¸ª`;
                }
            }
            
            // ä¿å­˜ç”¨æˆ·æœ€é«˜åˆ†
            function saveUserHighScore(newScore) {
                if (currentUser && newScore > (userHighScores[currentUser] || 0)) {
                    userHighScores[currentUser] = newScore;
                    localStorage.setItem('jumpGameHighScores', JSON.stringify(userHighScores));
                    highScoreElement.textContent = `æœ€é«˜åˆ†: ${newScore} ä¸ª`;
                    if (soundEnabled) highScoreSound();
                }
            }
            
            // åŠ¨æ€è§£é”æ˜“ç¢éšœç¢ç‰©
            function unlockBreakableObstacle() {
                const breakableType = obstacleTypes.find(type => type.type === 'breakable');
                if (breakableType && breakableType.spawnChance === 0) {
                    breakableType.spawnChance = 0.1; // è§£é”10%æ¦‚ç‡ç”Ÿæˆ
                    // æ›´æ–°å…¶ä»–éšœç¢ç‰©æ¦‚ç‡
                    obstacleTypes.forEach(type => {
                        if (type.type !== 'breakable' && type.spawnChance > 0) {
                            type.spawnChance *= 0.95;
                        }
                    });
                }
            }
            
            // è·³è·ƒæ ¸å¿ƒé€»è¾‘
            function jump() {
                if (isJumping || !gameRunning || !currentUser) return;
                
                if (soundEnabled) jumpSound();
                
                // éšæœºæ˜Ÿæ˜Ÿåç§»
                player.style.setProperty('--star-offset', `${Math.random() * 10 - 5}px`);
                
                isJumping = true;
                let currentPos = playerStartPos;
                
                player.classList.add('jumping');
                player.classList.remove('peaking', 'falling', 'landing');
                
                // ä¸Šå‡é˜¶æ®µï¼ˆæ…¢åŠ¨ä½œæ—¶è°ƒæ•´é€Ÿåº¦ï¼‰
                const jumpSpeed = isSlowMotion ? 4 : 6;
                const jumpUp = setInterval(() => {
                    currentPos += jumpSpeed;
                    player.style.bottom = `${currentPos}px`;
                    
                    if (currentPos >= jumpHeight - 15) {
                        player.classList.remove('jumping');
                        player.classList.add('peaking');
                    }
                    
                    if (currentPos >= jumpHeight) {
                        clearInterval(jumpUp);
                        
                        // æœ€é«˜ç‚¹åœç•™
                        setTimeout(() => {
                            player.classList.remove('peaking');
                            player.classList.add('falling');
                            
                            // ä¸‹é™é˜¶æ®µ
                            const jumpDown = setInterval(() => {
                                currentPos -= (isSlowMotion ? 3 : 5);
                                player.style.bottom = `${currentPos}px`;
                                
                                if (currentPos <= playerStartPos) {
                                    clearInterval(jumpDown);
                                    currentPos = playerStartPos;
                                    player.style.bottom = `${currentPos}px`;
                                    
                                    // è½åœ°æ•ˆæœ
                                    player.classList.remove('falling');
                                    player.classList.add('landing');
                                    if (soundEnabled) landSound();
                                    
                                    setTimeout(() => {
                                        player.classList.remove('landing');
                                        isJumping = false;
                                    }, 200);
                                }
                            }, 16);
                        }, isSlowMotion ? 200 : 120);
                    }
                }, 16);
            }
            
            // éšæœºé€‰æ‹©éšœç¢ç‰©ç±»å‹
            function selectObstacleType() {
                // åˆ†æ•°è¾¾åˆ°20è§£é”æ˜“ç¢éšœç¢ç‰©
                if (score >= 20) {
                    unlockBreakableObstacle();
                }
                
                const rand = Math.random();
                let cumulativeProbability = 0;
                
                for (const type of obstacleTypes) {
                    cumulativeProbability += type.spawnChance;
                    if (rand <= cumulativeProbability) {
                        return type;
                    }
                }
                
                // é»˜è®¤è¿”å›åŸºç¡€éšœç¢ç‰©
                return obstacleTypes[0];
            }
            
            // åˆ›å»ºéšœç¢ç‰©
            function createObstacle() {
                if (!gameRunning || !currentUser) return;
                
                const obstacle = document.createElement('div');
                obstacle.classList.add('obstacle');
                
                // éšæœºé€‰æ‹©éšœç¢ç‰©ç±»å‹
                const selectedType = selectObstacleType();
                obstacle.classList.add(selectedType.type);
                
                // ä¸ºæ¯ä¸ªéšœç¢ç‰©åˆ†é…å”¯ä¸€ID
                const obstacleId = `obs-${obstacleIdCounter++}`;
                obstacle.dataset.id = obstacleId;
                obstacle.dataset.obstacleType = selectedType.type;
                
                // æ ¹æ®ç±»å‹è°ƒæ•´å°ºå¯¸
                const baseSize = Math.min(window.innerWidth * 0.05, 50);
                const obstacleWidth = Math.floor(baseSize * selectedType.sizeMultiplier);
                const obstacleHeight = selectedType.type === 'large' 
                    ? Math.floor(baseSize * 1.8) 
                    : Math.floor(baseSize * selectedType.sizeMultiplier);
                
                obstacle.style.width = `${obstacleWidth}px`;
                obstacle.style.height = `${obstacleHeight}px`;
                
                // åˆå§‹ä½ç½®
                obstacle.style.left = `${window.innerWidth}px`;
                obstacle.style.bottom = `${groundHeight}px`;
                gameArea.appendChild(obstacle);
                
                // ç‰¹æ®Šéšœç¢ç‰©çš„åˆå§‹é…ç½®
                let floatDirection = 1;
                
                // ç§»åŠ¨éšœç¢ç‰©
                const moveObstacle = () => {
                    if (!gameRunning || !obstacle.parentNode) return;
                    
                    // æ ¹æ®éšœç¢ç‰©ç±»å‹è°ƒæ•´é€Ÿåº¦
                    const speedMultiplier = selectedType.speedMultiplier;
                    // æ…¢åŠ¨ä½œæ•ˆæœè°ƒæ•´
                    const currentSpeed = isSlowMotion ? (gameSpeed * speedMultiplier * 0.5) : (gameSpeed * speedMultiplier);
                    // é€Ÿåº¦æå‡æ•ˆæœè°ƒæ•´
                    const finalSpeed = isSpeedBoost ? (currentSpeed * 1.5) : currentSpeed;
                    
                    let currentLeft = parseFloat(obstacle.style.left) - finalSpeed;
                    
                    // æµ®åŠ¨éšœç¢ç‰©çš„å‚ç›´ç§»åŠ¨
                    if (selectedType.type === 'floating') {
                        const currentBottom = parseFloat(obstacle.style.bottom);
                        obstacle.style.bottom = `${currentBottom + (floatDirection * 0.5)}px`;
                        
                        if (currentBottom >= groundHeight + 30) floatDirection = -1;
                        if (currentBottom <= groundHeight) floatDirection = 1;
                    }
                    
                    obstacle.style.left = `${currentLeft}px`;
                    
                    // æ£€æµ‹æ˜¯å¦è·³è¿‡éšœç¢ç‰©
                    const playerRect = player.getBoundingClientRect();
                    const obstacleRect = obstacle.getBoundingClientRect();
                    const playerX = playerRect.left + playerRect.width / 2;
                    const obstacleX = obstacleRect.left + obstacleRect.width / 2;
                    
                    // å½“éšœç¢ç‰©è¶…è¿‡ç©å®¶ä¸”æœªè®°å½•è¿‡æ—¶ï¼Œå¢åŠ åˆ†æ•°
                    if (obstacleX < playerX && !skippedObstacleIds.has(obstacleId)) {
                        skippedObstacleIds.add(obstacleId);
                        updateScore();
                    }
                    
                    // ç¢°æ’æ£€æµ‹
                    if (checkCollision(playerRect, obstacleRect) && !isInvincible) {
                        // æ˜“ç¢éšœç¢ç‰©å¤„ç†
                        if (selectedType.type === 'breakable') {
                            obstacle.classList.add('breaking');
                            if (soundEnabled) breakSound();
                            setTimeout(() => {
                                if (obstacle.parentNode) {
                                    obstacle.parentNode.removeChild(obstacle);
                                }
                            }, 300);
                        } else {
                            gameOver();
                        }
                    }
                    
                    // ç§»é™¤è¶…å‡ºå±å¹•çš„éšœç¢ç‰©
                    if (currentLeft < -obstacleWidth) {
                        if (obstacle.parentNode) {
                            obstacle.parentNode.removeChild(obstacle);
                        }
                        skippedObstacleIds.delete(obstacleId);
                    } else {
                        requestAnimationFrame(moveObstacle);
                    }
                };
                
                moveObstacle();
            }
            
            // ç¢°æ’æ£€æµ‹
            function checkCollision(rect1, rect2) {
                return !(
                    rect1.right < rect2.left ||
                    rect1.left > rect2.right ||
                    rect1.bottom < rect2.top ||
                    rect1.top > rect2.bottom
                );
            }
            
            // æ›´æ–°åˆ†æ•°
            function updateScore() {
                const scoreIncrement = isDoubleScore ? 2 : 1;
                score += scoreIncrement;
                
                // åˆ†æ•°åŠ¨ç”»
                scoreElement.textContent = score;
                scoreElement.classList.add('updating');
                setTimeout(() => {
                    scoreElement.classList.remove('updating');
                }, 100);
                
                // åˆ†æ•°çˆ†ç‚¸ç‰¹æ•ˆ
                const scorePop = document.createElement('div');
                scorePop.classList.add('score-pop');
                scorePop.textContent = `+${scoreIncrement}`;
                scorePop.style.left = `${15}vw`;
                scorePop.style.top = `${20}vh`;
                gameArea.appendChild(scorePop);
                
                setTimeout(() => {
                    if (scorePop.parentNode) {
                        scorePop.parentNode.removeChild(scorePop);
                    }
                }, 1000);
                
                if (soundEnabled) scoreSound();
                
                // éš¾åº¦é€’å¢
                if (score % 10 === 0) {
                    gameSpeed = Math.min(gameSpeed + 0.2, 8);
                    obstacleInterval = Math.max(obstacleInterval - 50, 800);
                    
                    // é‡ç½®å®šæ—¶å™¨ä»¥åº”ç”¨æ–°çš„é—´éš”
                    if (gameRunning) {
                        clearInterval(obstacleTimer);
                        obstacleTimer = setInterval(createObstacle, obstacleInterval);
                    }
                }
            }
            
            // åˆ›å»ºé“å…·
            function createPowerUp() {
                if (!gameRunning || !currentUser || Math.random() > powerUpConfig.spawnChance) return;
                
                const powerUpTypes = powerUpConfig.types;
                let rand = Math.random();
                let cumulativeProbability = 0;
                let selectedPowerUp = null;
                
                // éšæœºé€‰æ‹©é“å…·ç±»å‹
                for (const type of powerUpTypes) {
                    cumulativeProbability += type.chance;
                    if (rand <= cumulativeProbability) {
                        selectedPowerUp = type;
                        break;
                    }
                }
                
                if (!selectedPowerUp) return;
                
                const powerUp = document.createElement('div');
                powerUp.classList.add('power-up', selectedPowerUp.type);
                powerUp.textContent = selectedPowerUp.icon;
                
                // éšæœºä½ç½®
                const baseSize = Math.min(window.innerWidth * 0.04, 45);
                powerUp.style.width = `${baseSize}px`;
                powerUp.style.height = `${baseSize}px`;
                powerUp.style.left = `${window.innerWidth}px`;
                powerUp.style.bottom = `${groundHeight + Math.random() * 100}px`;
                
                gameArea.appendChild(powerUp);
                
                // ç§»åŠ¨é“å…·
                const movePowerUp = () => {
                    if (!gameRunning || !powerUp.parentNode) return;
                    
                    const currentSpeed = isSlowMotion ? (gameSpeed * 0.5) : gameSpeed;
                    const finalSpeed = isSpeedBoost ? (currentSpeed * 1.5) : currentSpeed;
                    
                    let currentLeft = parseFloat(powerUp.style.left) - finalSpeed;
                    powerUp.style.left = `${currentLeft}px`;
                    
                    // é“å…·ç¢°æ’æ£€æµ‹
                    const playerRect = player.getBoundingClientRect();
                    const powerUpRect = powerUp.getBoundingClientRect();
                    
                    if (checkCollision(playerRect, powerUpRect)) {
                        activatePowerUp(selectedPowerUp);
                        if (powerUp.parentNode) {
                            powerUp.parentNode.removeChild(powerUp);
                        }
                        return;
                    }
                    
                    // ç§»é™¤è¶…å‡ºå±å¹•çš„é“å…·
                    if (currentLeft < -baseSize) {
                        if (powerUp.parentNode) {
                            powerUp.parentNode.removeChild(powerUp);
                        }
                    } else {
                        requestAnimationFrame(movePowerUp);
                    }
                };
                
                movePowerUp();
            }
            
            // æ¿€æ´»é“å…·
            function activatePowerUp(powerUp) {
                if (soundEnabled) powerUpSound();
                
                // æ¸…é™¤ç°æœ‰é“å…·æ•ˆæœ
                clearPowerUps();
                
                switch (powerUp.type) {
                    case 'speed-boost':
                        isSpeedBoost = true;
                        player.style.filter = 'drop-shadow(0 0 10px #ffeb3b)';
                        setTimeout(() => {
                            isSpeedBoost = false;
                            player.style.filter = '';
                        }, powerUp.duration);
                        break;
                        
                    case 'shield':
                        isInvincible = true;
                        shieldElement = document.createElement('div');
                        shieldElement.classList.add('player-shield');
                        player.appendChild(shieldElement);
                        setTimeout(() => {
                            isInvincible = false;
                            if (shieldElement && shieldElement.parentNode) {
                                shieldElement.parentNode.removeChild(shieldElement);
                                shieldElement = null;
                            }
                        }, powerUp.duration);
                        break;
                        
                    case 'double-score':
                        isDoubleScore = true;
                        scoreElement.style.color = '#ff9800';
                        setTimeout(() => {
                            isDoubleScore = false;
                            scoreElement.style.color = '#7b1fa2';
                        }, powerUp.duration);
                        break;
                        
                    case 'slow-motion':
                        isSlowMotion = true;
                        gameArea.style.filter = 'sepia(20%)';
                        if (soundEnabled) slowMotionSound();
                        setTimeout(() => {
                            isSlowMotion = false;
                            gameArea.style.filter = '';
                        }, powerUp.duration);
                        break;
                }
            }
            
            // æ¸…é™¤æ‰€æœ‰é“å…·æ•ˆæœ
            function clearPowerUps() {
                isSpeedBoost = false;
                isDoubleScore = false;
                isSlowMotion = false;
                
                if (isInvincible && shieldElement) {
                    isInvincible = false;
                    if (shieldElement.parentNode) {
                        shieldElement.parentNode.removeChild(shieldElement);
                        shieldElement = null;
                    }
                }
                
                player.style.filter = '';
                scoreElement.style.color = '#7b1fa2';
                gameArea.style.filter = '';
            }
            
            // æ¸¸æˆç»“æŸ
            function gameOver() {
                if (!gameRunning) return;
                
                gameRunning = false;
                clearInterval(obstacleTimer);
                clearInterval(powerUpTimer);
                clearPowerUps();
                
                if (soundEnabled) hitSound();
                
                // ä¿å­˜æœ€é«˜åˆ†
                saveUserHighScore(score);
                
                // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
                finalScoreElement.textContent = score;
                gameOverScreen.style.display = 'block';
                
                // éœ‡åŠ¨æ•ˆæœ
                gameContainer.style.animation = 'vibrate 0.5s ease-in-out';
                setTimeout(() => {
                    gameContainer.style.animation = '';
                }, 500);
            }
            
            // é‡ç½®æ¸¸æˆ
            function resetGame() {
                // æ¸…é™¤æ‰€æœ‰éšœç¢ç‰©å’Œé“å…·
                document.querySelectorAll('.obstacle').forEach(obs => obs.remove());
                document.querySelectorAll('.power-up').forEach(pu => pu.remove());
                document.querySelectorAll('.score-pop').forEach(sp => sp.remove());
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                score = 0;
                gameSpeed = 5;
                obstacleInterval = 1800;
                gameRunning = true;
                isJumping = false;
                skippedObstacleIds.clear();
                obstacleIdCounter = 0;
                clearPowerUps();
                
                // é‡ç½®UI
                scoreElement.textContent = '0';
                gameOverScreen.style.display = 'none';
                player.style.bottom = `${playerStartPos}px`;
                player.className = `player skin-${getUserSkin(currentUser)}`; // é‡ç½®æ—¶ä¿ç•™ç”¨æˆ·çš®è‚¤
                gameContainer.style.animation = '';
            }
            
            // é‡æ–°å¼€å§‹æ¸¸æˆ
            function restartGame() {
                resetGame();
                
                // é‡å¯å®šæ—¶å™¨
                startGameTimers();
                
                // éšè—æ¸¸æˆç»“æŸç•Œé¢
                gameOverScreen.style.display = 'none';
            }
            
            // å¯åŠ¨æ¸¸æˆå®šæ—¶å™¨
            function startGameTimers() {
                if (obstacleTimer) clearInterval(obstacleTimer);
                if (powerUpTimer) clearInterval(powerUpTimer);
                
                obstacleTimer = setInterval(createObstacle, obstacleInterval);
                powerUpTimer = setInterval(createPowerUp, powerUpConfig.spawnInterval);
            }
            
            // åˆå§‹åŒ–ç”¨æˆ·æ•°æ®
            initUserData();
        });
    </script>
</body>
</html>
